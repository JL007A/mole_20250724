<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>泰山打地鼠遊戲</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/css/bootstrap.min.css" />
    <style>
      body {
        background: url("./images/a0.jpg") no-repeat center center fixed;
        background-size: cover;
        color: #5c5c5c;
        font-family: "GenWanMin TW", sans-serif;
      }
      .game-title {
        text-align: center;
        margin-top: 30px;
        margin-bottom: -10px;
        font-size: 4rem;
        color: yellow;
        font-weight: bold;
        text-shadow: 0 0 8px #ffd54f;
      }
      .score {
        font-size: 1.2rem;
        background: rgba(255, 255, 255, 0.7);
        min-height: 100px;
        border: 1px solid #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(255, 255, 255, 0.7);
        margin-bottom: 40px;
      }
      .mole-center {
        border-radius: 20px;
        max-height: 400px;
        border: 10px solid #fff;
        object-fit: contain;
        box-shadow: 0 4px 15px rgb(0 0 0 / 0.3);
      }
      .mole-img {
        max-height: 400px;
        width: auto;
      }
      .hammer-img {
        max-height: 400px;
      }
      button {
        width: 200px;
        height: 50px;
        padding: 0.8rem 1.2rem;
        font-size: 1.4rem;
        font-weight: bold;
        box-shadow: 0 4px 15px rgb(0 0 0 / 0.3);
      }
      button:hover {
        font-size: 1.2rem;
        box-shadow: 3px 3px rgba(0, 0, 0, 0.4);
      }
      .hide-btn {
        display: none;
      }
      .show-btn {
        display: inline-block;
      }
      .display-3 {
        font-size: 3rem;
      }
      @media (max-width: 767.98px) {
        .desktop-only {
          display: none !important;
          text-align: center;
        }
        .game-title {
          font-size: 1.8rem;
        }
        .display-3 {
          font-size: 2rem;
        }
        .score-section {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container mt-3">
      <div class="d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center">
          <h1 class="game-title">泰山 '打地鼠'遊戲</h1>
          <hr class="border-light" />
        </div>
      </div>

      <div class="col-12 col-4 score d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center score-section">
          倒數計時
          <br />
          <span class="text-info display-3" id="time">10</span>
          <span>秒</span>
        </div>
        <div class="text-center score-section">
          目前分數
          <br />
          <span class="text-success display-3" id="score">0</span>
        </div>
        <div class="text-center score-section">
          最高分數
          <br />
          <span class="text-danger display-3" id="maxScore">0</span>
        </div>
      </div>
    </div>

    <div class="container mt-3">
      <div class="col-12 d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center">
          <img src="./images/a2.png" alt="地鼠" class="mole-img desktop-only" />
        </div>
        <div class="text-center">
          <img src="./images/1.jpg" alt="地鼠" class="mole-center" id="moleImage" />
        </div>
        <div class="text-center">
          <img src="./images/a3.png" alt="大木槌" class="hammer-img desktop-only" />
        </div>
      </div>
    </div>

    <div class="container mt-4 text-center">
      <button id="startBtn" class="btn btn-primary me-3">開始</button>
      <button id="pauseBtn" class="btn btn-warning me-3 hide-btn">暫停</button>
      <button id="resumeBtn" class="btn btn-secondary me-3 hide-btn">取消暫停</button>
      <button id="hitBtn" class="btn btn-success me-3 hide-btn">打地鼠</button>
      <button id="stopBtn" class="btn btn-danger me-3 hide-btn">重置</button>
    </div>

    <!-- ✅ 事件日誌 -->
    <div class="container mt-4">
      <div id="eventLog" class="bg-light p-3 rounded shadow border" style="height: 200px; overflow-y: auto">
        <p class="text-muted">事件日誌：</p>
      </div>
    </div>

    <!-- Bootstrap JS + jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
      const startBtn = document.getElementById("startBtn");
      const hitBtn = document.getElementById("hitBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const resumeBtn = document.getElementById("resumeBtn");
      const stopBtn = document.getElementById("stopBtn");
      const moleImage = document.getElementById("moleImage");
      const timeSpan = document.getElementById("time");
      const scoreSpan = document.getElementById("score");
      const maxScoreSpan = document.getElementById("maxScore");
      const eventLog = document.getElementById("eventLog");

      let score = 0;
      let maxScore = Number(localStorage.getItem("maxScore")) || 0;
      let startTime = 10;
      let bonusTime = 5;
      let myInterval = null;
      let isPaused = false;

      maxScoreSpan.innerText = maxScore;
      const hitSound = new Audio("./sounds/ouch.mp3");

      function logEvent(eventType) {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        const newLog = document.createElement("p");
        newLog.textContent = `[${timeString}] 事件: ${eventType}`;
        eventLog.prepend(newLog);
        if (eventLog.children.length > 30) {
          eventLog.removeChild(eventLog.lastChild);
        }
      }

      function updateTimeDisplay() {
        timeSpan.innerText = startTime;
        timeSpan.className = startTime < bonusTime ? "text-danger display-3" : "text-info display-3";
      }

      function startGame() {
        score = 0;
        startTime = 10;
        updateTimeDisplay();
        scoreSpan.innerText = score;
        moleImage.src = "./images/1.jpg";
        hitBtn.classList.remove("hide-btn");
        pauseBtn.classList.remove("hide-btn");
        stopBtn.classList.remove("hide-btn");
        startBtn.classList.add("hide-btn");

        myInterval = setInterval(() => {
          if (!isPaused) {
            startTime--;
            updateTimeDisplay();
            if (startTime < 1) {
              clearInterval(myInterval);
              hitBtn.classList.add("hide-btn");
              pauseBtn.classList.add("hide-btn");
              startBtn.classList.remove("hide-btn");
              moleImage.src = "./images/1.jpg";
            }
          }
        }, 1000);
      }

      function pauseGame() {
        isPaused = true;
        pauseBtn.classList.add("hide-btn");
        resumeBtn.classList.remove("hide-btn");
        moleImage.src = "./images/1.jpg";
      }

      function resumeGame() {
        isPaused = false;
        resumeBtn.classList.add("hide-btn");
        pauseBtn.classList.remove("hide-btn");
        moleImage.src = "./images/1.jpg";
      }

      function stopGame() {
        clearInterval(myInterval);
        isPaused = false;
        score = 0;
        startTime = 10;
        scoreSpan.innerText = score;
        updateTimeDisplay();
        hitBtn.classList.add("hide-btn");
        pauseBtn.classList.add("hide-btn");
        resumeBtn.classList.add("hide-btn");
        stopBtn.classList.add("hide-btn");
        startBtn.classList.remove("hide-btn");
        moleImage.src = "./images/1.jpg";
      }

      function hitMole() {
        if (startTime < 1 || isPaused) return;
        hitSound.currentTime = 0;
        hitSound.play();
        score += startTime > bonusTime ? 2 : 3;
        scoreSpan.innerText = score;
        if (score > maxScore) {
          maxScore = score;
          localStorage.setItem("maxScore", maxScore);
          maxScoreSpan.innerText = maxScore;
        }
      }

      // 綁定按鈕事件
      startBtn.addEventListener("click", startGame);
      pauseBtn.addEventListener("click", pauseGame);
      resumeBtn.addEventListener("click", resumeGame);
      stopBtn.addEventListener("click", stopGame);

      // ✅ 多平台事件偵測：點擊 + 觸控 + pointer
      hitBtn.addEventListener("pointerdown", () => {
        logEvent("pointerdown");
        if (startTime < 1 || isPaused) return;
        moleImage.src = "./images/2.jpg";
        hitMole();
      });

      hitBtn.addEventListener("pointerup", () => {
        logEvent("pointerup");
        if (startTime < 1 || isPaused) return;
        moleImage.src = "./images/1.jpg";
      });

      hitBtn.addEventListener(
        "touchstart",
        () => {
          logEvent("touchstart");
          if (startTime < 1 || isPaused) return;
          moleImage.src = "./images/2.jpg";
          hitMole();
        },
        { passive: true }
      );

      hitBtn.addEventListener("touchend", () => {
        logEvent("touchend");
        if (startTime < 1 || isPaused) return;
        moleImage.src = "./images/1.jpg";
      });

      hitBtn.addEventListener("click", () => {
        logEvent("click");
      });
    </script>
  </body>
</html>
