<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 在 <head> 中添加版本控制的 meta 標籤，防止瀏覽器快取 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico" />

    <!-- <title>泰山打地鼠遊戲</title> -->
    <title>JCODE打地鼠遊戲</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/css/bootstrap.min.css" />
    <style>
      html,
      body {
        background: url("./images/a0.jpg") no-repeat center center fixed;
        background-size: cover;
        color: #5c5c5c;
        /* font-family: "ZCOOL KuaiLe", cursive; */
        /* font-family: "YuanSuei-Regular", sans-serif; */
        /* font-family: "JinXuan-Bold", sans-serif; */
        font-family: "GenWanMin TW", sans-serif;
        /* min-height: 100dvh; 讓最小高度是 100px，但可隨文字自動撐高*/
        height: 100dvh; /*讓高度是 100px*/
      }

      .game-title {
        text-align: center;
        /* margin-top: 30px; */
        margin-bottom: -10px;
        /* padding-top: 25px; */
        font-size: 4rem;
        color: yellow;
        font-weight: bold;
        text-shadow: 0 0 8px #ffd54f;
        /* text-shadow: 2px 2px #500808, 4px 4px #260404; */
        /* box-shadow: 2px 2px #500808, 4px 4px #260404; */
        /* border-radius: 6px 6px 6px 6px; */
      }
      .score {
        font-size: 1.2rem;
        color: #5b5b5b;
        font-weight: bold;
        /* background-color: yellow; */
        background: rgba(255, 255, 255, 0.7);
        min-height: 100px;
        border: 1px solid #ffffff;
        border-radius: 12px;
        /* border-radius: 12px 12px 12px 12px; */
        /* box-shadow: 0 2px 2px rgba(255, 255, 255, 0.7), 4px 34px rgba(255, 255, 255, 0.4); */
        box-shadow: 0 4px 15px rgba(255, 255, 255, 0.7);
        margin-bottom: 30px; /* origin:40px; */
      }
      .mole-center {
        border-radius: 20px;
        max-height: 380px; /* origin:400px; */
        width: auto;

        border: 10px solid #fff; /* 可選：白色邊框增強視覺效果 */
        object-fit: contain; /* 確保圖片完整顯示 */
        /* box-shadow: 2px 2px rgba(0, 0, 0, 0.4), 4px 4px rgba(0, 0, 0, 0.7); */
        box-shadow: 0 4px 15px rgb(0 0 0 / 0.3);
        /* position: relative;
        left: -5px; */
      }
      .mole-img {
        max-height: 400px;
        width: auto;
        margin: auto;
      }

      .hammer-img {
        max-height: 400px;
        /* position: relative;
        left: -30px; */
        /* transform: rotate(-30deg); */
      }

      /* 讓按鈕群置中且整齊排版 */
      .btn-wrap {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        padding: 0 10px 0 0;
        margin-left: 25px;
      }

      /* 按鈕樣式 */
      button {
        width: 140px; /* 按鈕寬度 :原150, 160px*/
        height: 50px;
        padding: 0.8rem 1.2rem;
        font-size: 1.4rem;
        font-weight: bold;
        /* box-shadow: 3px 3px rgba(0, 0, 0, 0.4); */
        box-shadow: 5px 5px rgba(0, 0, 0, 0.4);
        /* box-shadow: 0 4px 15px rgb(0 0 0 / 0.3); */
        border: 2px solid white;
        touch-action: manipulation; /* 可以禁止預設行為  解決問題:蘋果連點兩下會放大 */
        opacity: 0.8;
      }
      button:hover {
        font-size: 1.1rem;
        box-shadow: 6px 6px rgba(0, 0, 0, 0.4);
      }
      .hide-btn {
        display: none;
      }

      .show-btn {
        display: inline-block;
      }

      .display-3 {
        font-size: 3rem;
      }

      .my-white-border {
        border: 3px solid #eee !important;
      }
      /* RWD 調整 + 手機裝置隱藏指定圖片*/
      /* 這樣當瀏覽器寬度在 767.98px 以下（手機裝置常見寬度）時，兩張圖片會自動隱藏。在桌機版則照常顯示。 */
      @media (max-width: 767.98px) {
        .desktop-only {
          display: none !important;
          text-align: center;
        }
        .game-title {
          font-size: 1.8rem;
        }

        .display-3 {
          font-size: 2rem;
        }

        .score-section {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="container mt-3">
      <!-- 遊戲標題 -->
      <div class="d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center">
          <h1 class="game-title">JCODE '打地鼠'遊戲</h1>
          <hr class="border-light" />
        </div>
      </div>
      <!-- 計時與分數區塊（Flex + RWD） -->
      <div class="col-12 col-4 score d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center score-section">
          倒數計時
          <br />
          <span class="text-info display-3" id="time">10</span>
          <span style="font-weight: lighter">秒</span>
        </div>
        <div class="text-center score-section">
          <div>
            目前分數
            <br />
            <span class="text-success display-3" id="score">0</span>
          </div>
        </div>
        <div class="text-center score-section">
          最高分數
          <br />
          <span class="text-danger display-3" id="maxScore">0</span>
        </div>
      </div>
    </div>

    <div class="container mt-3">
      <!-- style="border: 1px solid #ffffff" -->
      <!-- 手機裝置隱藏指定圖片  desktop-only-->
      <div class="col-12 d-flex align-items-center justify-content-around flex-wrap">
        <div class="text-center">
          <img src="./images/a2.png" alt="地鼠" class="mole-img desktop-only" id="" />
        </div>
        <div class="text-center">
          <img src="./images/1.jpg" alt="地鼠" class="mole-center" id="moleImage" />
        </div>
        <div class="text-center">
          <img src="./images/a3.png" alt="大木槌" class="hammer-img desktop-only" />
        </div>
      </div>
    </div>

    <div class="container">
      <div class="rol mt-4 text-center btn-wrap">
        <button id="startBtn" class="btn btn-primary me-3 my-white-border">開始</button>

        <button id="pauseBtn" class="btn btn-warning me-3 hide-btn my-white-border">暫停</button>
        <button id="resumeBtn" class="btn btn-secondary me-3 hide-btn my-white-border">取消暫停</button>
        <button id="hitBtn" class="btn btn-success me-3 hide-btn my-white-border">打地鼠</button>
        <button id="stopBtn" class="btn btn-danger me-3 hide-btn my-white-border">重置</button>
        <button id="clearScoreBtn" class="btn btn-secondary me-3 hide-btn my-white-border">清除最高分數</button>
      </div>
    </div>
    <!-- eventLog_01 -->
    <!-- <div class="container mt-4">
      <div id="eventLog" class="bg-light p-3 rounded shadow border" style="height: 200px; overflow-y: auto">
        <p class="text-muted border" style="background-color: #e2e2e2">事件日誌：</p>
      </div>
    </div> -->
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
      $(document).ready(function () {
        // === 取得 DOM 元素（jQuery 選擇器） ===
        const $startBtn = $("#startBtn"); // 開始遊戲按鈕
        const $hitBtn = $("#hitBtn"); // 打地鼠按鈕
        const $pauseBtn = $("#pauseBtn"); // 暫停遊戲按鈕
        const $resumeBtn = $("#resumeBtn"); // 取消暫停按鈕
        const $stopBtn = $("#stopBtn"); // 重置遊戲按鈕
        const $moleImage = $("#moleImage"); // 中間地鼠圖片

        const $timeSpan = $("#time"); // 倒數計時顯示
        const $scoreSpan = $("#score"); // 當前分數顯示
        const $maxScoreSpan = $("#maxScore"); // 最高分顯示
        const $clearScoreBtn = $("#clearScoreBtn"); // 清除最高分數按鈕

        // === 遊戲變數 ===
        let score = 0; // 當前分數
        let maxScore = Number(localStorage.getItem("maxScore")) || 0; // 最高分數（從 localStorage 讀取）
        let startTime = 10; // 初始倒數秒數
        let bonusTime = 5; // 加分時間門檻
        let myInterval = null; // 計時器 ID
        let isPaused = false; // 是否暫停遊戲

        // 初始化最高分顯示
        $maxScoreSpan.text(maxScore);

        // 音效物件
        const hitSound = new Audio("./sounds/c1.mp3");

        /**
         * 更新倒數時間顯示
         */
        function updateTimeDisplay() {
          $timeSpan.text(startTime);
          if (startTime < bonusTime) {
            $timeSpan.attr("class", "text-danger display-3"); // 時間快結束 → 紅色
          } else {
            $timeSpan.attr("class", "text-info display-3"); // 正常時間 → 藍色
          }
        }

        /**
         * 開始遊戲
         */
        function startGame() {
          score = 0;
          startTime = 10;
          updateTimeDisplay();
          $scoreSpan.text(score);
          $moleImage.attr("src", "./images/1.jpg"); // 顯示初始地鼠

          // 顯示遊戲中按鈕，隱藏開始按鈕
          $hitBtn.removeClass("hide-btn");
          $pauseBtn.removeClass("hide-btn");
          $stopBtn.removeClass("hide-btn");
          $clearScoreBtn.removeClass("hide-btn");
          $startBtn.addClass("hide-btn");

          // 啟動計時器
          myInterval = setInterval(() => {
            if (!isPaused) {
              startTime--;
              updateTimeDisplay();
              if (startTime < 1) {
                clearInterval(myInterval);
                $hitBtn.addClass("hide-btn");
                $pauseBtn.addClass("hide-btn");
                $startBtn.removeClass("hide-btn");
                $moleImage.attr("src", "./images/1.jpg"); // 時間到顯示初始地鼠
              }
            }
          }, 1000);
        }

        /**
         * 暫停遊戲
         */
        function pauseGame() {
          isPaused = true;
          $pauseBtn.addClass("hide-btn");
          $resumeBtn.removeClass("hide-btn");
          $moleImage.attr("src", "./images/1.jpg"); // 暫停顯示初始地鼠
        }

        /**
         * 恢復遊戲
         */
        function resumeGame() {
          isPaused = false;
          $resumeBtn.addClass("hide-btn");
          $pauseBtn.removeClass("hide-btn");
          $moleImage.attr("src", "./images/1.jpg");
        }

        /**
         * 重置遊戲
         */
        function stopGame() {
          clearInterval(myInterval);
          isPaused = false;
          score = 0;
          startTime = 10;
          $scoreSpan.text(score);
          updateTimeDisplay();

          // 隱藏遊戲按鈕，顯示開始按鈕
          $hitBtn.addClass("hide-btn");
          $pauseBtn.addClass("hide-btn");
          $resumeBtn.addClass("hide-btn");
          $stopBtn.addClass("hide-btn");
          $clearScoreBtn.addClass("hide-btn");
          $startBtn.removeClass("hide-btn");

          $moleImage.attr("src", "./images/1.jpg");
        }

        /**
         * 清除最高分數
         */
        function clearMaxScore() {
          localStorage.removeItem("maxScore");
          maxScore = 0;
          $maxScoreSpan.text(maxScore);
        }

        /**
         * 打地鼠動作
         */
        function hitMole() {
          if (startTime < 1 || isPaused) return;

          hitSound.currentTime = 0;
          hitSound.play();

          // 計分邏輯
          score += startTime > bonusTime ? 2 : 3;
          $scoreSpan.text(score);

          // 更新最高分
          if (score > maxScore) {
            maxScore = score;
            localStorage.setItem("maxScore", maxScore);
            $maxScoreSpan.text(maxScore);
          }
        }

        // === 綁定事件 ===
        $startBtn.on("click", startGame); // 開始
        $pauseBtn.on("click", pauseGame); // 暫停
        $resumeBtn.on("click", resumeGame); // 恢復
        $stopBtn.on("click", stopGame); // 重置
        $clearScoreBtn.on("click", clearMaxScore); // 清除最高分

        // 滑鼠/觸控按下 → 換成地鼠被打的圖片 & 計分
        $hitBtn.on("pointerdown", function () {
          if (startTime < 1 || isPaused) return;
          $moleImage.attr("src", "./images/2.jpg");
          hitMole();
        });

        // 滑鼠/觸控放開 → 換回正常地鼠圖片
        $hitBtn.on("pointerup", function () {
          if (startTime < 1 || isPaused) return;
          $moleImage.attr("src", "./images/1.jpg");
        });
      });
    </script>
  </body>
</html>
